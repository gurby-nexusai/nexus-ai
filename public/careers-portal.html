<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Careers - Apply Now</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 3rem;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }
    
    .header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }
    
    .jobs-grid {
      display: grid;
      gap: 1.5rem;
      margin-bottom: 3rem;
    }
    
    .job-card {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .job-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .job-card h3 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #333;
    }
    
    .job-card .meta {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    
    .job-card .description {
      color: #555;
      line-height: 1.6;
      margin-bottom: 1rem;
    }
    
    .job-card button {
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .job-card button:hover {
      opacity: 0.9;
    }
    
    .application-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 2rem;
    }
    
    .application-modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      padding: 2.5rem;
      border-radius: 12px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-content h2 {
      margin-bottom: 0.5rem;
      color: #333;
    }
    
    .modal-content .job-title {
      color: #666;
      margin-bottom: 2rem;
      font-size: 1.1rem;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: #333;
    }
    
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 1rem;
      font-family: inherit;
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .form-group input[type="file"] {
      padding: 0.5rem;
    }
    
    .form-actions {
      display: flex;
      gap: 1rem;
      margin-top: 2rem;
    }
    
    .form-actions button {
      flex: 1;
      padding: 1rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    .btn-cancel {
      background: #ddd;
      color: #333;
    }
    
    .btn-submit {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-submit:hover,
    .btn-cancel:hover {
      opacity: 0.9;
    }
    
    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .success-message {
      display: none;
      background: #d4edda;
      color: #155724;
      padding: 1.5rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      text-align: center;
    }
    
    .success-message.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Join Our Team</h1>
      <p>Explore open positions and apply today</p>
    </div>

    <div class="success-message" id="successMessage">
      ‚úì Application submitted successfully! We'll review your application and get back to you soon.
    </div>

    <div class="jobs-grid" id="jobsGrid">
      <!-- Jobs will be loaded here -->
    </div>
  </div>

  <!-- Application Modal -->
  <div class="application-modal" id="applicationModal">
    <div class="modal-content">
      <h2>Apply for Position</h2>
      <div class="job-title" id="modalJobTitle"></div>
      
      <form id="applicationForm">
        <div class="form-group">
          <label>Full Name *</label>
          <input type="text" id="candidateName" required>
        </div>
        
        <div class="form-group">
          <label>Email *</label>
          <input type="email" id="candidateEmail" required>
        </div>
        
        <div class="form-group">
          <label>Phone</label>
          <input type="tel" id="candidatePhone">
        </div>
        
        <div class="form-group">
          <label>LinkedIn Profile</label>
          <input type="url" id="candidateLinkedin" placeholder="https://linkedin.com/in/yourprofile">
        </div>
        
        <div class="form-group">
          <label>Resume/CV * (.txt, .docx)</label>
          <input type="file" id="candidateResume" accept=".txt,.docx" required>
        </div>
        
        <div class="form-group">
          <label>Cover Letter (Optional)</label>
          <textarea id="candidateCoverLetter" placeholder="Tell us why you're a great fit..."></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
          <button type="submit" class="btn-submit" id="submitBtn">Submit Application</button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
  <script>
    let selectedJobId = null;

    // Load jobs from localStorage (same as internal app)
    function loadJobs() {
      try {
        const jobs = JSON.parse(localStorage.getItem('job_postings') || '[]');
        const jobsGrid = document.getElementById('jobsGrid');
        
        if (jobs.length === 0) {
          jobsGrid.innerHTML = '<div style="background: white; padding: 3rem; border-radius: 12px; text-align: center; color: #666;">No open positions at this time. Check back soon!</div>';
          return;
        }
        
        jobsGrid.innerHTML = jobs.map(job => `
          <div class="job-card" onclick="openApplication(${job.id}, '${escapeHtml(job.title)}')">
            <h3>üíº ${escapeHtml(job.title)}</h3>
            <div class="meta">üìç Remote ‚Ä¢ ‚è∞ Full-time ‚Ä¢ üìÖ Posted ${new Date(job.createdAt).toLocaleDateString()}</div>
            <div class="description">${escapeHtml(job.description.substring(0, 200))}...</div>
            <button onclick="event.stopPropagation(); openApplication(${job.id}, '${escapeHtml(job.title)}')">Apply Now ‚Üí</button>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading jobs:', error);
        document.getElementById('jobsGrid').innerHTML = '<div style="background: white; padding: 3rem; border-radius: 12px; text-align: center; color: #666;">Unable to load positions. Please try again later.</div>';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function openApplication(jobId, jobTitle) {
      selectedJobId = jobId;
      document.getElementById('modalJobTitle').textContent = jobTitle;
      document.getElementById('applicationModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('applicationModal').classList.remove('active');
      document.getElementById('applicationForm').reset();
      selectedJobId = null;
    }

    // Handle form submission
    document.getElementById('applicationForm').onsubmit = async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
      
      const name = document.getElementById('candidateName').value;
      const email = document.getElementById('candidateEmail').value;
      const phone = document.getElementById('candidatePhone').value;
      const linkedin = document.getElementById('candidateLinkedin').value;
      const coverLetter = document.getElementById('candidateCoverLetter').value;
      const resumeFile = document.getElementById('candidateResume').files[0];
      
      try {
        let resumeContent = '';
        
        if (resumeFile.name.endsWith('.docx')) {
          const arrayBuffer = await resumeFile.arrayBuffer();
          const result = await mammoth.extractRawText({ arrayBuffer });
          resumeContent = result.value;
        } else {
          resumeContent = await resumeFile.text();
        }
        
        if (!resumeContent.trim()) {
          throw new Error('Could not extract text from file');
        }
        
        saveApplication(name, email, phone, linkedin, coverLetter, resumeContent);
      } catch (error) {
        alert('Error processing resume: ' + error.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Application';
      }
    };
    
    function saveApplication(name, email, phone, linkedin, coverLetter, resumeContent) {
      const submitBtn = document.getElementById('submitBtn');
      
      // Save to localStorage
      const candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
      const candidate = {
        id: Date.now(),
        name: name,
        resume: resumeContent,
        jobId: selectedJobId,
        uploadedAt: new Date().toISOString(),
        status: 'Pending Review',
        email: email,
        phone: phone,
        linkedin: linkedin,
        coverLetter: coverLetter
      };
      
      candidates.push(candidate);
      localStorage.setItem('candidates', JSON.stringify(candidates));
      
      closeModal();
      document.getElementById('successMessage').classList.add('active');
      setTimeout(() => {
        document.getElementById('successMessage').classList.remove('active');
      }, 5000);
      
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Application';
    }

    // Load jobs on page load
    loadJobs();
  </script>
</body>
</html>
